import matplotlib.pyplot as plt
import pandas as pd
import os


# Create directory for saving results if does not exist
result_directory="RQ3-Result"
if not os.path.exists(result_directory):
    os.makedirs(result_directory)

# open the file containing name of the languages and omit the \n
data_directory="RQ3-Data"
filename="{}/language_names.txt".format(data_directory)
with open(filename) as f:
    lines = f.readlines()
language_names = [line.rstrip('\n') for line in lines]

for language_name in language_names:

    # Read language data from csv file
    project_data = pd.read_csv("{}/{}.csv".format(data_directory,language_name))

    # Generate hexbin plot for each language and save the plot
    print("###### Generating hexbin plot for {} language ######".format(language_name))
    plt.hexbin(project_data["code_ratio_of_pl"],project_data["average_severity"], gridsize=30,bins='log', cmap='Reds')
    plt.title("{}".format(language_name))
    plt.xlabel("{} Code Ratio".format(language_name))
    plt.ylabel("Average Vulnerability Severity")
    plt.rcParams["figure.figsize"] = [10,8]
    plt.savefig("{}/{}.png".format(result_directory,language_name))
    plt.close()